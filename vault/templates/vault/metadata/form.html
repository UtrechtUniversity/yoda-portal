path
tokenName
tokenHash
formProperties

{% autoescape false %}
  {{ path | replace(" ", "&nbsp;") }}
{% endautoescape %}
{% autoescape false %}
    <p>autoescaping is disabled here
    <p>{{ will_not_be_escaped }}
{% endautoescape %}
base64_encode

<div id="form-errors" class="row hide">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header clearfix">
                <h3 class="card-title pull-left">
                    Metadata form - {{ }}<?php echo str_replace(' ', '&nbsp;', htmlentities(trim($path))); ?>
                </h3>
                <div class="input-group-sm has-feedback pull-right">
                    <a class="btn btn-secondary" href="/vault/browse?dir=<?php echo rawurlencode($path); ?>">Close</a>
                </div>
            </div>
            <div class="card-body">
                <p>
                    It is not possible to load this form as the yoda-metadata.json file is not
                    in accordance with the form definition.
                </p>
                <p>
                    Please check the following in your JSON file:
                </p>
                    <ul class="error-fields"></ul>
            </div>
        </div>
    </div>
</div>

<div id="metadata-form" class="row hide">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title pull-left">
                    Metadata form - <?php echo str_replace(' ', '&nbsp;', htmlentities(trim($path))); ?>
                </h3>
                <div class="input-group-sm has-feedback pull-right close-button">
                    <a class="btn btn-light btn-sm" href="/vault/browse?dir=<?php echo rawurlencode($path); ?>">Close</a>
                </div>
            </div>
            <div class="card-body">
                <div id="no-metadata" class="hide">
                    <p>There is no metadata present for this folder.</p>
                </div>
                <div id="form"
                     data-path="<?php echo htmlentities($path); ?>"
                     data-csrf_token_name="<?php echo rawurlencode($tokenName); ?>"
                     data-csrf_token_hash="<?php echo rawurlencode($tokenHash); ?>">
                    <p>Loading metadata <i class="fa fa-spinner fa-spin fa-fw"></i></p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Show "loading" text if loading the form takes longer than expected.
var formLoaded = false;
setTimeout(function(){
    if (!formLoaded) {
        $('#metadata-form').fadeIn(200);
        $('#metadata-form').removeClass('hide');
    }
}, 800);
</script>
<script src="/vault/static/js/metadata/form.js" async></script>
<script id="form-properties" type="text/plain"><?php
// base64-encode to make sure no script tag can be embedded.
echo base64_encode(json_encode($formProperties))
?></script>

base64_encode => https://stackoverflow.com/questions/24831543/base-64-encode-a-json-variable-in-python

https://docs.python.org/3/library/json.html
json_encode
 import json
>>> json.dumps(['foo', {'bar': ('baz', None, 1.0, 2)}])
'["foo", {"bar": ["baz", null, 1.0, 2]}]'

