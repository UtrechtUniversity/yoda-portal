{% extends 'base.html' %}

{% block title %}{{ super() }} &dash; Statistics{% endblock title %}

{% block style %}
    <link rel="stylesheet" href="{{ url_for('static', filename='lib/datatables-1.11.2/datatables.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('stats_bp.static', filename='lib/select2/css/select2.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('stats_bp.static', filename='css/stats.css') }}">
{% endblock style %}

{% block scripts %}
    <script src="{{ url_for('static', filename='lib/datatables-1.11.2/datatables.min.js') }}"></script>
    <script src="{{ url_for('stats_bp.static', filename='lib/chartjs-4.2.0/chart.min.js') }}"></script>
    <script src="{{ url_for('stats_bp.static', filename='js/stats.js') }}"></script>
    <script src="{{ url_for('stats_bp.static', filename='lib/select2/js/select2.full.min.js') }}"></script>
{% endblock scripts %}

{% block content %}
    <h1>Statistics</h1>

    {% if categories %}
    <div class="row mb-4">
        <div class="col-md-7">
            <div class="card">
                <div class="card-header">
                    Storage
                </div>
                <div class="card-body">
                    <table class="table table-striped storage-table">
                        <tr>
                            <th>Category</th>
                            <th>Storage</th>
                            <th>Research</th>
                            <th>Vault</th>
                            <th>Revision</th>
                        </tr>
                        {% for category in categories %}
                            <tr>
                                <td>{{ category.category }}</td>
                                <td>{{ category.storage.total }}</td>
                                <td>{{ category.storage.research }}</td>
                                <td>{{ category.storage.vault }}</td>
                                <td>{{ category.storage.revision }}</td>
                            </tr>
                        {% endfor %}
                    </table>

                    <a href="{{ url_for('stats_bp.export') }}" class="btn btn-primary btn-sm">
                        Export all details
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="row">
        <div class="col-md-5">
            <div class="card">
                <div class="card-header">
                    Groups

                    <div class="input-group-sm has-feedback float-end">
                        <input class="form-control form-control-sm" id="search-group-table" type="text" maxlength="63" placeholder="Search groups" />
                    </div>
                </div>
                <div>
                    <table id="group-browser" class="table yoda-table table-striped">
                        <thead>
                        <tr>
                            <th>Name</th>
                            <th>Size</th>
                        </tr>
                        </thead>
                    </table>
                </div>
                <div class="card-footer"></div>
            </div>
        </div>
        <div class="col-md-7">
            <div class="group-details">
                <div class="card">
                    <div class="card-header" id="selected-group">
                        Group
                    </div>
                    <div class="card-body">
                        <div id="storage-chart-message">
                            <p class="placeholder-text">
                                Please select a group.
                            </p>
                        </div>
                        <div id="storage-chart" class="hidden">
                            <canvas id="myChart"></canvas>
                            <input onchange="chartFilterDate()" type="date" id="startdate" value="2023-01-25">
                            <input onchange="chartFilterDate()" type="date" id="enddate" value="2023-01-31">

                            <button class="item" id="legend-research" onClick="chartToggleData(0)">&nbsp;Research&nbsp;</button>
                            <button class="item" id="legend-vault" onClick="chartToggleData(1)">&nbsp;Vault&nbsp;</button>
                            <button class="item" id="legend-revisions" onClick="chartToggleData(2)">&nbsp;Revisions&nbsp;</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}
